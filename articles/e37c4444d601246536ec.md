---
title: "Go 1.16ã§è¿½åŠ ã•ã‚ŒãŸiotest.ErrReaderã‚’ä½¿ã£ã¦io.Readerã®ç•°å¸¸ç³»ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹"
emoji: "ğŸ‚"
type: "tech"
topics: ["go"]
published: true
---

# `io.ReadAll`ãªã©ã®ç•°å¸¸ç³»ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„

ä¾‹ãˆã°æ¬¡ã®`io.Reader`ã‚’å—ã‘ã¦ä¸­èº«ã®æ–‡å­—åˆ—ã‚’è¿”ã™é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã—ãŸã„ã¨ãã€`io.ReadAll`ã«`err`ã‚’è¿”ã•ã›ã‚‹ã®ãŒé›£ã—ã„ã®ã§ç•°å¸¸ç³»ã®ãƒ†ã‚¹ãƒˆãŒæ›¸ãã«ããã†ã§ã™ã€‚

```go:read.go
import "io"

func read(r io.Reader) (string, error) {
	b, err := io.ReadAll(r)
	if err != nil {
		return "", err
	}

	return string(b), nil
}
```

# `iotest.ErrReader`ã‚’ä½¿ãˆã°å‡ºæ¥ã‚‹

Go 1.16ã‹ã‚‰æ–°ã—ã`testing/iotest`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«è¿½åŠ ã•ã‚ŒãŸ`iotest.ErrReader`ã‚’ä½¿ãˆã°`io.Reader`ã‚’ä¼´ã†é–¢æ•°ã®ç•°å¸¸ç³»ã‚’ç°¡å˜ã«ãƒ†ã‚¹ãƒˆå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```go:read_test.go
import (
	"errors"
	"io"
	"strings"
	"testing"
	"testing/iotest"
)

func Test_read(t *testing.T) {
	t.Parallel()

	cases := map[string]struct {
		r     io.Reader
		str   string
		noErr bool
	}{
		"success": {
			r:     strings.NewReader("test"),
			str:   "test",
			noErr: true,
		},
		"failure": {
			r:     iotest.ErrReader(errors.New("test")),
			str:   "",
			noErr: false,
		},
	}

	for name, c := range cases {
		c := c
		t.Run(name, func(t *testing.T) {
			t.Parallel()

			str, err := read(c.r)

			if str != c.str {
				t.Errorf("want '%v', got '%v'", c.str, str)
			}
			if c.noErr {
				if err != nil {
					t.Error("want 'nil', got 'not nil'")
				}
			} else {
				if err == nil {
					t.Error("want 'not nil', got 'nil'")
				}
			}
		})
	}
}
```

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚‚ãƒãƒƒãƒãƒªã§ã™

![](https://storage.googleapis.com/zenn-user-upload/wibgnld27gu21p1tvx0klq0jjjuh)
