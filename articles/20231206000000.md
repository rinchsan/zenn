---
title: "pprotein ã§ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’æ¢ã—ã¦ ISUCON ã§å„ªå‹ã™ã‚‹"
emoji: "ğŸª‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["isucon"]
published: true
published_at: 2023-12-06 00:00
publication_name: team_soda
---

## ï¼¼[ã‚¹ãƒ‹ãƒ€ãƒ³ã‚’é–‹ç™ºã—ã¦ã„ã‚‹SODA inc.ã® Advent Calendar](https://qiita.com/advent-calendar/2023/soda-inc) 6æ—¥ç›®ã®è¨˜äº‹ã§ã™!!!ï¼

æ˜¨æ—¥ã¯ [@decoch718](https://twitter.com/decoch718) ã•ã‚“ã«ã‚ˆã‚‹ã€Œã€ã§ã—ãŸï¼
æ˜æ—¥ã¯ [@KosukeSaigusa](https://twitter.com/KosukeSaigusa) ã•ã‚“ã«ã‚ˆã‚‹ã€ŒDart ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã€ã§ã™ï¼ãŠæ¥½ã—ã¿ã«ï¼

https://qiita.com/advent-calendar/2023/soda-inc

## ã¯ã˜ã‚ã«

### æ¨æ¸¬ã™ã‚‹ãªã€è¨ˆæ¸¬ã›ã‚ˆ

> Rule 1.  You can't tell where a program is going to spend its time.  Bottlenecks occur in surprising places, so don't try to second guess and put in a speed hack until you've proven that's where the bottleneck is.
> Rule 2.  Measure.  Don't tune for speed until you've measured, and even then don't unless one part of the code overwhelms the rest.
> 
> Rob Pike, "Notes on Programming in C" (1989), https://www.lysator.liu.se/c/pikestyle.html

https://www.lysator.liu.se/c/pikestyle.html

Rob Pikeæ°ãŒæœ€åˆã«ãã‚Œã‚‰ã—ã„ã“ã¨ã‚’è¨€ã£ãŸåŸå…¸ã‚’ã‚«ãƒƒã‚³ã¤ã‘ã¦æŒã£ã¦ãã¾ã—ãŸã€‚
çš†ã•ã‚“ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã‚’ã™ã‚‹ã¨ãã¯æ¨æ¸¬ã›ãšã«è¨ˆæ¸¬ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ISUCONã§ã¯ç‰¹ã«ã€ã€Œè¨ˆæ¸¬â†’æ”¹å–„â†’è¨ˆæ¸¬â†’â€¦ã€ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ã©ã‚Œã ã‘é«˜é€Ÿã«å›ã›ã‚‹ã‹ãŒã¨ã£ã¦ã‚‚é‡è¦ã§ã™ã€‚

### pproteinã§è¨ˆæ¸¬ã›ã‚ˆ

https://github.com/kaz/pprotein

3å¤§è¨ˆæ¸¬ãƒã‚¤ãƒ³ãƒˆ(?)ã§ã‚ã‚‹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ã¾ã¨ã‚ã¦è¨ˆæ¸¬ã—ã¦å¯è¦–åŒ–ã—ã¦ãã‚Œã‚‹ç¥ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
pproteinãŒãªã„ã¨ã€ãƒ­ã‚°ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ãƒˆã‚’ã—ãŸã‚Šã€ãƒ­ã‚°ã‚’æ‰‹å…ƒã«æŒã£ã¦ãã¦alpãªã©ã§åˆ†æã—ãŸã‚Šã€ `go tool pprof` ã§æ¯å›è¨ˆæ¸¬ã‚’èµ°ã‚‰ã›ãŸã‚Šã€ãã‚Œã‚‰ã®è¨ˆæ¸¬çµæœã‚’ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«å…±æœ‰ã—ãŸã‚Šã€ã¨è‰²ã€…ãªã“ã¨ã‚’ã—ãªã„ã¨ã„ã‘ãªãã¦å¤§å¤‰ã§ã™ã€‚

ISUCON13çµ‚äº†ç›´å¾Œã®ç¾åœ¨ã¯ã€å„ªå‹ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ã®1äººã§ã‚ã‚‹ [ã¨ãƒ¼ãµã¨ãµã•ã‚“](https://twitter.com/to_hutohu) ãŒè‡ªãƒãƒ¼ãƒ ã§ä½¿ã£ã¦ã„ãŸpproteinã‚’å…¬é–‹ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’è¦‹ã‚Œã°ã©ã‚“ãªãƒ„ãƒ¼ãƒ«ã‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ç°¡å˜ã«ã¤ãã§ã—ã‚‡ã†ã€‚
ãã—ã¦ã“ã®ãƒ„ãƒ¼ãƒ«ã¯åŒã˜ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã‚ã‚‹ [sekaiã•ã‚“](https://twitter.com/sekai67) ãŒä½œã£ãŸãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚ã‚ŠãŒãŸã‚„ã€‚

https://pprotein.isucon13.to-hutohu.com/#/group/

### pproteinã®ä½¿ã„æ–¹ã‚’ã”ç´¹ä»‹ã—ã¾ã™

æœ¬è¨˜äº‹ã§ã¯pproteinã®ä½¿ã„æ–¹ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚
ãƒªãƒã‚¸ãƒˆãƒªã«READMEãŒç½®ã‹ã‚Œã¦ãŠã‚‰ãšã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«ã‚‚ä½¿ã„æ–¹ã‚’ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸ãªã©ãŒè¦‹å½“ãŸã‚‰ãšã€åˆã‚ã¦ä½¿ã†ã¨ãã¯å°‘ã—å¤§å¤‰ã§ã—ãŸã€‚
Goã§æ›¸ã‹ã‚Œã¦ã¦èª­ã¿ã‚„ã™ã‹ã£ãŸã“ã¨ã‚‚ã‚ã‚Šã€pproteinã®ã‚³ãƒ¼ãƒ‰ã‚’å…¨éƒ¨èª­ã‚“ã§ç†è§£ã—ã¾ã—ãŸ()

## è¨ˆæ¸¬å¯¾è±¡ã®æº–å‚™

ã¾ãšã¯è¨ˆæ¸¬ãŒã§ãã‚‹ã‚ˆã†å„ã‚µãƒ¼ãƒã§æº–å‚™ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### Goã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®pprof

ã“ã‚Œã¯ `echov4.EnableDebugHandler(e)` ã‚’ `main` é–¢æ•°ã«ç½®ãã ã‘ã§ç°¡å˜ã§ã™ã€‚
pprof ã‚’å˜ä½“ã§ä½¿ã†å ´åˆã¯ `net/http/pprof` ã‚’Blank importã—ãŸã‚Šã€6060ç•ªãƒãƒ¼ãƒˆã‚’è‡ªåˆ†ã§é–‹æ”¾ã—ãŸã‚Šã€ãŒå¿…è¦ã§ã™ãŒã€ãã®ã‚ãŸã‚Šã«ç›¸å½“ã™ã‚‹ã“ã¨ã¯ã„ã„æ„Ÿã˜ã«å†…éƒ¨ã§ã‚„ã£ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/rinchsan/isucon13-final/blob/2a77f2ab583ed28dd7d74473c2db2a855718d891/webapp/go/main.go#L131

https://github.com/rinchsan/isucon13-final/commit/2a77f2ab583ed28dd7d74473c2db2a855718d891#diff-871eb89e86e63e7eca84f0075cba1a75574a11341cd89d39c7891864d2b085b9

`gin` ãªã©ä»–ã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¦ä¾¿åˆ©ã§ã™ã€‚

https://github.com/kaz/pprotein/blob/master/integration/gin/integrate.go

ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡ã¯æ°—ã«ã›ãšã« `standalone.Integrate(":19000")` ã®ã‚ˆã†ã«19000ç•ªãƒãƒ¼ãƒˆã§å…¬é–‹ã™ã‚‹ã®ã‚‚ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

https://github.com/kaz/pprotein/blob/master/integration/standalone/integrate.go

### MySQLã®ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°

ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
Ansible ã§ã„ã„æ„Ÿã˜ã«é©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚

https://github.com/rinchsan/isucon13-final/blob/d20043cd58fafc6e9e7f257d04c169126e069412/ansible/roles/mysql/files/etc/mysql/mysql.conf.d/mysqld.cnf#L65-L67

https://github.com/rinchsan/isucon13-final/commit/d20043cd58fafc6e9e7f257d04c169126e069412

ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ãŒPermission Deniedã«ãªã‚‹å ´åˆã¯ `chmod` ã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚

```bash
sudo chmod +rx /var/log/mysql/
sudo chmod +r /var/log/mysql/mysql-slow.log
```

#### MySQLã‚’åˆ¥ã‚µãƒ¼ãƒã«åˆ†é›¢ã—ã¦ã‚‚å¤§ä¸ˆå¤«

ã ã£ã¦ `pprotein-agent` ãŒã‚ã‚‹ã®ã ã‹ã‚‰ã€‚

é€”ä¸­ã§MySQLã‚’åˆ¥ã‚µãƒ¼ãƒã«é€ƒãŒã—ã¦è¤‡æ•°å°æ§‹æˆã«ã™ã‚‹ã¨ã€å½“ãŸã‚Šå‰ã§ã™ãŒGoã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°ã‚’ç›´æ¥å–å¾—ã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ãã®å ´åˆã¯ `pprotein-agent` ã¨ã„ã†ãƒ—ãƒ­ã‚»ã‚¹ã‚’MySQLãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒã§ç¨¼åƒã•ã›ã‚‹ã“ã¨ã§pproteinãŒãƒ­ã‚°ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
è©³ç´°ã¯å¾Œè¿°ã®ã€Œpprotein-agentã®serviceã‚’èµ·å‹•ã€ã«ã¦ã€‚

### Nginxã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°

ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ãŒltsvå½¢å¼ã§å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
ã“ã¡ã‚‰ã‚‚ Ansible ã§ã„ã„æ„Ÿã˜ã«é©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚

https://github.com/rinchsan/isucon13-final/blob/397a82463177e828090b3224bc1ad1b8de9e2e59/ansible/roles/nginx/files/etc/nginx/nginx.conf#L43-L59

https://github.com/rinchsan/isucon13-final/commit/397a82463177e828090b3224bc1ad1b8de9e2e59

ãƒ­ã‚°ã®èª­ã¿è¾¼ã¿ãŒPermission Deniedã«ãªã‚‹å ´åˆã¯ `chmod` ã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ï¼ˆã“ã‚Œã‚‚Ansibleã§ã‚„ã‚‹ã¨ä¾¿åˆ©ã§ã™ï¼‰ã€‚

```bash
sudo chmod +r /var/log/nginx/access.log
```

#### Nginxã‚’åˆ¥ã‚µãƒ¼ãƒã«åˆ†é›¢ã—ã¦ã‚‚å¤§ä¸ˆå¤«

ã ã£ã¦ `pprotein-agent` ãŒã‚ã‚‹ã®ã ã‹ã‚‰ã€‚

MySQLã¨åŒã˜ãNginxã‚’åˆ¥ã‚µãƒ¼ãƒã«é€ƒãŒã™å ´åˆã‚‚Goã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’ç›´æ¥å–å¾—ã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ã“ã®å ´åˆã‚‚ `pprotein-agent` ã‚’Nginxã‚µãƒ¼ãƒã§ç¨¼åƒã•ã›ã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã™ã€‚

## pproteinã®æº–å‚™

ã“ã“ã‹ã‚‰pproteinæœ¬ä½“ã®æº–å‚™ã«å…¥ã‚Šã¾ã™ï¼ˆãƒ¯ã‚¯ãƒ¯ã‚¯ï¼‰ã€‚

### CloudFormationã§ã‚µãƒ¼ãƒèµ·å‹•

CloudFormationã‚’åˆ©ç”¨ã—ã¦ã€è¨ˆæ¸¬å¯¾è±¡ã‚µãƒ¼ãƒã¨åŒã˜VPCã€åŒã˜Subnetã«pproteinç”¨ã®ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¾ã™ã€‚
ISUCON13ã§ã¯ä¸€å¿œç«¶æŠ€ç”¨ã‚µãƒ¼ãƒã¨åŒã˜AMIã§EC2ã‚’èµ·å‹•ã—ã¾ã—ãŸãŒã€åˆ¥ã®AMIã§ã‚‚å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚

https://github.com/rinchsan/isucon13-final/blob/0c242ccd085cefd7f5544201b3101b0cb59b7fb6/provisioning/cf_pprotein.yaml

https://github.com/rinchsan/isucon13-final/commit/0c242ccd085cefd7f5544201b3101b0cb59b7fb6

CloudFormationã®Parametersã§VPCã¨Subnetã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ç”¨æ„ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™ã€‚
ã¾ãŸã€ç«¶æŠ€ç”¨ã‚µãƒ¼ãƒã®Security Groupã¯å¤‰æ›´ã—ã¦ã—ã¾ã†ã¨å¤±æ ¼ã«ãªã‚‹ã®ã§ã™ãŒã€pproteinç”¨ã®ã‚µãƒ¼ãƒã¯å¤‰æ›´ã—ã¦å•é¡Œãªã„ã®ã§ã€9000ç•ªãƒãƒ¼ãƒˆã‚’é–‹æ”¾ã—ã¦ãŠãã¾ã™ã€‚

### å‘¨è¾ºãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã«ã€pproteinã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ç¾¤ã‚’ãƒãƒ³ãƒãƒ³å…¥ã‚Œã¦ã„ãã¾ã—ã‚‡ã†ã€‚

#### pprof

```bash
sudo apt install -y graphviz gv
```

#### ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°

```bash
wget https://github.com/tkuchiki/slp/releases/download/v0.2.0/slp_linux_amd64.tar.gz
tar -xvf slp_linux_amd64.tar.gz
sudo mv slp /usr/local/bin/slp
```

#### ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°

```bash
wget https://github.com/tkuchiki/alp/releases/download/v1.0.21/alp_linux_amd64.tar.gz
tar -xvf alp_linux_amd64.tar.gz
sudo mv alp /usr/local/bin/alp
```

#### pproteinæœ¬ä½“

```bash
wget https://github.com/kaz/pprotein/releases/download/v1.2.3/pprotein_1.2.3_linux_amd64.tar.gz
tar -xvf pprotein_1.2.3_linux_amd64.tar.gz
```

### pproteinã®serviceã‚’èµ·å‹•

pproteinç”¨ã‚µãƒ¼ãƒã§ `/etc/systemd/system/pprotein.service` ã‚’ä½œã£ã¦èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚
èµ·å‹•ã«æˆåŠŸã™ã‚‹ã¨ `http://{pproteinç”¨ã‚µãƒ¼ãƒã®Public IP}:9000` ã§pproteinã®Web UIã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

```systemd:/etc/systemd/system/pprotein.service
[Unit]
Description=pprotein service

[Service]
ExecStart=/home/isucon/pprotein
WorkingDirectory=/home/isucon
Environment=PATH=$PATH:/usr/local/bin
Restart=always
User=root

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl start pprotein
```

### pprotein-agentã®serviceã‚’èµ·å‹•

MySQLãŒåˆ¥ã‚µãƒ¼ãƒã®å ´åˆã¯ã€ãã®ã‚µãƒ¼ãƒã§ `/etc/systemd/system/pprotein-agent.service` ã‚’ä½œã£ã¦èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚
èµ·å‹•ã«æˆåŠŸã™ã‚‹ã¨19000ç•ªãƒãƒ¼ãƒˆã§ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°ãŒå–å¾—ã§ãã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
`/var/log/mysql/mysql-slow.log` ãªã©ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®Permissionã«ã”æ³¨æ„ã‚’ã€‚

```bash
wget https://github.com/kaz/pprotein/releases/download/v1.2.3/pprotein_1.2.3_linux_amd64.tar.gz
tar -xvf pprotein_1.2.3_linux_amd64.tar.gz
```

```systemd:/etc/systemd/system/pprotein-agent.service
[Unit]
Description=pprotein-agent service

[Service]
ExecStart=/home/isucon/pprotein-agent
WorkingDirectory=/home/isucon
Environment=PATH=$PATH:/usr/local/bin
Restart=always
User=root

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl start pprotein-agent
```

### `group/targets` ã®è¨­å®š

pproteinã®Web UIä¸Šã«ã‚ã‚‹ `setting` ã‹ã‚‰ãƒ­ã‚°åé›†ã«é–¢ã™ã‚‹ã‚’è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚

`group/targets` ã¯åŸºæœ¬çš„ã«ã¯è¨ˆæ¸¬å¯¾è±¡ã‚µãƒ¼ãƒã®Private IPã¨ãƒ­ã‚°ã‚’å–å¾—ã§ãã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ãƒˆã‚’è¨­å®šã—ã¦ã„ãã ã‘ã§OKã§ã™ã€‚
ã“ã“ã§ `standalone.Integrate` ã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã™ã¹ã¦ã®ãƒãƒ¼ãƒˆã‚’19000ç•ªã«ã§ãã‚‹ã®ã§è„³å†…ãƒ¡ãƒ¢ãƒªã‚’ç¯€ç´„ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã­ã€‚
ã¡ãªã¿ã«ã€ã“ã“ã§ã®è¨­å®šå†…å®¹ã¯pproteinç”¨ã‚µãƒ¼ãƒä¸Šã® `/home/isucon/data/targets.json` ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

```json:group/targetsã®ä¾‹
[
  {
    "Type": "pprof",
    "Label": "webapp",
    "URL": "http://192.168.0.11:8080/debug/pprof/profile",
    "Duration": 60
  },
  {
    "Type": "httplog",
    "Label": "nginx",
    "URL": "http://192.168.0.11:8080/debug/log/httplog",
    "Duration": 60
  },
  {
    "Type": "slowlog",
    "Label": "mysql",
    "URL": "http://192.168.0.12:19000/debug/log/slowlog",
    "Duration": 60
  }
]
```

### `httplog/config` ã®è¨­å®š

`httplog/config` ã¯Path Parameterã‚’å—ã‘å–ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æ­£è¦è¡¨ç¾ã§ã„ã„æ„Ÿã˜ã«ã¾ã¨ã‚ã‚‹è¨­å®šã‚’æ›¸ãã¾ã™ã€‚
ã¡ãªã¿ã«ã€ã“ã“ã§ã®è¨­å®šå†…å®¹ã¯pproteinç”¨ã‚µãƒ¼ãƒä¸Šã® `/home/isucon/data/alp.yml` ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

```yaml:httplog/configã®ä¾‹
matching_groups:
    - ^/api/user/[0-9a-zA-Z_-]+/theme$
    - ^/api/user/[0-9a-zA-Z_-]+/livestream$
    - ^/api/livestream/[0-9a-f_-]+$
    - ^/api/livestream/[0-9a-f_-]+/livecomment$
    - ^/api/livestream/[0-9a-f_-]+/reaction$
    - ^/api/livestream/[0-9a-f_-]+/report$
    - ^/api/livestream/[0-9a-f_-]+/ngwords$
    - ^/api/livestream/[0-9a-f_-]+/livecomment/[0-9a-f_-]+/report$
    - ^/api/livestream/[0-9a-f_-]+/moderate$
    - ^/api/livestream/[0-9a-f_-]+/enter$
    - ^/api/livestream/[0-9a-f_-]+/exit$
    - ^/api/user/[0-9a-zA-Z_-]+$
    - ^/api/user/[0-9a-zA-Z_-]+/statistics$
    - ^/api/user/[0-9a-zA-Z_-]+/icon$
    - ^/api/livestream/[0-9a-f_-]+/statistics$
```

## ã„ã–è¨ˆæ¸¬

ISUCONã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚«ãƒ¼ã¯ã¾ãšæœ€åˆã«initializeå‡¦ç†ã‚’ã—ã¦åˆæœŸãƒ‡ãƒ¼ã‚¿ä½œã£ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚
ãã®initializeå‡¦ç†ã®æœ€å¾Œã«pproteinã§ã®è¨ˆæ¸¬ã‚’è‡ªå‹•ã§ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚

https://github.com/rinchsan/isucon13-final/blob/837b95d24f3a42b24f02b69728846c06f99a7ccf/webapp/go/main.go#L114-L118

https://github.com/rinchsan/isucon13-final/commit/837b95d24f3a42b24f02b69728846c06f99a7ccf

ãƒ¡ãƒ¢æ©Ÿèƒ½ã‚‚ã‚ã‚‹ã®ã§ã€ãƒ™ãƒ³ãƒã®ãƒ­ã‚°ã‚„ã‚¹ã‚³ã‚¢ã‚’è¨ˆæ¸¬çµæœã«ç´ã¥ã‘ã¦æ®‹ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã—ã‚‡ã†ï¼ˆã¨ã€å„ªå‹ãƒãƒ¼ãƒ ã®pproteinã‚’è¦‹ã¦æ€ã„ã¾ã—ãŸï¼ˆå°ä¸¦æ„Ÿï¼‰ï¼‰ã€‚

## ãŠã‚ã‚Šã«

å„ªå‹ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ï¼ï¼
ãŒã€åˆå‡ºå ´ã§ã‚‚é ‘å¼µã‚ŒãŸã®ã¯pproteinã®ãŠã‹ã’ã§ã™ï¼ï¼ï¼

https://zenn.dev/team_soda/articles/20231126195358
